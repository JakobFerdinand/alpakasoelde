---
import EventList from './EventList.astro';
---
<section class="dashboard-events section">
  <div class="container">
    <div class="events-header">
      <h2>Letzte Ereignisse</h2>
    </div>
    <EventList id="events-content" emptyText="Noch keine Ereignisse vorhanden." />
  </div>
</section>

<script>
  import { normalizeEvents, renderEventList, renderLoadingState } from './event-list';

  const eventsContainer = document.getElementById('events-content');

  const loadEvents = async () => {
    if (!eventsContainer) return;
    renderLoadingState(eventsContainer, 'Lade Ereignisse...');

    try {
      const response = await fetch('/api/events');
      if (!response.ok) {
        throw new Error('Ereignisse konnten nicht geladen werden.');
      }
      const events = await response.json();
      renderEventList(eventsContainer, normalizeEvents(events), {
        emptyText: eventsContainer.dataset.emptyText ?? 'Noch keine Ereignisse vorhanden.',
        showAlpakaNames: true
      });
    } catch (error) {
      console.error(error);
      eventsContainer.classList.remove('loading');
      eventsContainer.innerHTML = '<p class="error">Ereignisse konnten nicht geladen werden.</p>';
    }
  };

  loadEvents();
</script>

<style>
  .dashboard-events {
    background-color: var(--schurwolle);
    color: var(--taubenblau);
  }

  .events-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
  }
</style>
