---
import Layout from '../../layouts/Layout.astro';
---

<Layout title="Nachrichten">
  <section class="admin-page section">
    <div class="container">
      <h2>Eingegangene Nachrichten</h2>
      <div id="message-list" class="message-list">
        <p>Lade Nachrichten...</p>
      </div>
    </div>
  </section>
</Layout>

<script>
  async function loadMessages() {
    try {
      const res = await fetch('/api/get-messages');
      if (!res.ok) return;
      const msgs = await res.json();
      const list = document.getElementById('message-list');
      list.innerHTML = '';
      msgs.forEach((msg) => {
        const card = document.createElement('article');
        card.className = 'message-card';
        const time = new Date(msg.Timestamp).toLocaleString('de-AT', {
          timeZone: 'Europe/Vienna',
        });
        card.innerHTML = `\
          <header class="message-header">\
            <h3 class="message-sender">${msg.Name}</h3>\
            <a class="message-email" href="mailto:${msg.Email}">${msg.Email}</a>\
            <time class="message-time">${time}</time>\
          </header>\
          <p class="message-text">${msg.Message}</p>`;
        list.appendChild(card);
      });
    } catch {
      /* ignore */
    }
  }
  loadMessages();
</script>

<style>
  .admin-page {
    background-color: var(--seafoam-mist);
    color: var(--slate-river);
  }

  .message-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .message-card {
    background: var(--vanilla-cream);
    padding: 1rem;
    border-radius: 0.5rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .message-header {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    align-items: center;
    margin-bottom: 0.5rem;
  }

  .message-sender {
    margin: 0;
    font-size: 1.125rem;
    font-weight: 600;
  }

  .message-email {
    color: var(--slate-river);
  }

  .message-time {
    margin-left: auto;
    font-size: 0.875rem;
    color: var(--slate-river);
  }

  .message-text {
    margin: 0;
    white-space: pre-wrap;
    word-break: break-word;
  }
</style>
