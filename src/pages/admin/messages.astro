---
import Layout from '../../layouts/Layout.astro';
---

<Layout title="Nachrichten">
  <section class="admin-page section">
    <div class="container">
      <h2>Eingegangene Nachrichten</h2>
      <table class="message-table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Nachricht</th>
            <th>Zeitpunkt</th>
          </tr>
        </thead>
        <tbody id="message-table-body">
          <tr>
            <td colspan="4">Lade Nachrichten...</td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>
</Layout>

<script>
  async function loadMessages() {
    try {
      const res = await fetch('/api/get-messages');
      if (!res.ok) return;
      const msgs = await res.json();
      const tbody = document.getElementById('message-table-body');
      tbody.innerHTML = '';
      msgs.forEach((msg) => {
        const tr = document.createElement('tr');
        const time = new Date(msg.Timestamp).toLocaleString('de-AT', {
          timeZone: 'Europe/Vienna',
        });
        tr.innerHTML = `<td>${msg.Name}</td><td>${msg.Email}</td><td>${msg.Message}</td><td>${time}</td>`;
        tbody.appendChild(tr);
      });
    } catch {
      /* ignore */
    }
  }
  loadMessages();
</script>

<style>
  .admin-page {
    background-color: var(--seafoam-mist);
    color: var(--slate-river);
  }

  .message-table {
    width: 100%;
    border-collapse: collapse;
  }

  .message-table th,
  .message-table td {
    padding: 0.5rem;
    border: 1px solid var(--slate-river);
    text-align: left;
  }

  .message-table th {
    background: var(--dusty-sky);
    color: var(--vanilla-cream);
  }
</style>
