---
import Layout from '../../layouts/Layout.astro';
---

<Layout title="Admin Dashboard">
  <section class="admin-page section">
    <div class="container">
      <h2>Dashboard</h2>
      <div class="user-info">
        <img id="avatar" class="avatar" alt="" />
        <p id="greeting" class="greeting"></p>
      </div>
      <ul class="admin-links">
        <li><a class="btn" href="/admin/messages">Nachrichten</a></li>
      </ul>
    </div>
  </section>
</Layout>

<style>
  .admin-page {
    background-color: var(--seafoam-mist);
    color: var(--slate-river);
    text-align: center;
  }

  .user-info {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-bottom: 1rem;
  }

  .avatar {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    display: none;
  }

  .greeting {
    margin-top: 0.5rem;
    font-weight: bold;
  }

  .admin-links {
    list-style: none;
    padding: 0;
  }

  .admin-links li {
    margin-bottom: 1rem;
  }
</style>

<script>
  async function loadUser() {
    try {
      const res = await fetch('/.auth/me');
      if (!res.ok) return;
      const data = await res.json();
      const user = data.clientPrincipal;
      if (!user) return;
      const name = user.userDetails || 'User';
      document.getElementById('greeting').textContent = `Hallo ${name}!`;
      const avatar = document.getElementById('avatar');
      avatar.src = `https://github.com/${name}.png`;
      avatar.alt = name;
      avatar.style.display = 'block';
    } catch {
      /* ignore */
    }
  }
  loadUser();
</script>
